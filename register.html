<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">   

    <title>Member Registration</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/register.css">

</head>

<body>
    <div class="container   
 mt-5">
        <div class="card">
            <div class="card-header   
 text-center">
                <h4>Member Registration</h4>
            </div>
            <div class="card-body">
                <form action="register.php" id="registration-form" method="POST">
                    <input type="hidden" id="member_id" name="member_id">
                    <input type="hidden" id="age" name="age"> <div class="mb-3">
                        <label for="name" class="form-label">Full Name:</label>
                        <input type="text" id="name" name="name" class="form-control" required>
                    </div>

                    <div class="mb-3">
                        <label   
 for="contact_no" class="form-label">Contact Number:</label>
                        <input placeholder="(09******)" type="text" id="contact_no" name="contact_no" class="form-control" required>
                    </div>

                    <div class="mb-3">
                        <label for="email" class="form-label">Email Address:</label>
                        <input type="email" id="email" name="email" class="form-control"   
 required>
                    </div>

                    <div class="mb-3">
                        <label for="birthday"   
 class="form-label">Birthday:</label>
                        <input type="date" id="birthday" name="birthday" class="form-control"   
 required>
                    </div>

                    <div class="mb-3">
                        <label for="sex" class="form-label">Gender:</label>
                        <select id="sex" name="sex" class="form-control" required>
                            <option value="">Select</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                            <option value="Other">Other</option>   

                        </select>
                    </div>

                    <div class="mb-3">
                        <label   
 for="civil_status" class="form-label">Civil Status:</label>
                        <select id="civil_status" name="civil_status" class="form-control" required>
                            <option value="">Select</option>
                            <option value="Single">Single</option>
                            <option value="Married">Married</option>   

                            <option value="Divorced">Divorced</option>
                            <option value="Widowed">Widowed</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label   
 for="address" class="form-label">Address:</label>
                        <input type="text" id="address" name="address" class="form-control" required>
                    </div>

                    <div class="mb-3">
                        <label for="place_of_birth"   
 class="form-label">Place of Birth:</label>
                        <input type="text" id="place_of_birth" name="place_of_birth" class="form-control" required>
                    </div>

                    <div class="mb-3">
                        <label for="spouse_name" class="form-label">Name of Spouse:</label>
                        <input type="text" id="spouse_name" name="spouse_name" class="form-control">
                    </div>

                    <div class="mb-3">
                        <label for="children" class="form-label">Name of Children:</label>
                        <div id="children-container">
                            <div class="input-group mb-2">
                                <input type="text" id="child_1" name="children[]" class="form-control" placeholder="Child 1">
                                <button type="button" class="btn btn-secondary" id="add-child">Add Another Child</button>
                            </div>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Educational Attainment:</label>
                        <div id="education-container">
                            <div class="input-group mb-2">
                                <input type="text" name="education_date[]" class="form-control" placeholder="Inclusive Date Attended">
                                <input type="text" name="education_school[]" class="form-control" placeholder="Name of School">
                                <input type="text" name="education_course[]" class="form-control" placeholder="Course/Degree">
                            </div>
                        </div>
                        <button type="button" class="btn btn-secondary" id="add-education">Add Another Educational Record</button>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Employment Record:</label>
                        <div id="employment-container">
                            <div class="input-group mb-2">
                                <input type="text" name="employment_date[]" class="form-control" placeholder="Inclusive Date">
                                <input type="text" name="employment_position[]" class="form-control" placeholder="Position">
                                <input type="text" name="employment_school[]" class="form-control" placeholder="Name of School">
                            </div>
                        </div>
                        <button type="button" class="btn btn-secondary" id="add-employment">Add Another Employment Record</button>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Experience in Cooperative:</label>
                        <div id="cooperative-experience-container">
                            <div class="input-group mb-2">
                                <input type="text" name="cooperative_experience_date[]" class="form-control" placeholder="Inclusive Date">
                                <input type="text" name="cooperative_experience_position[]" class="form-control" placeholder="Position">
                                <input type="text" name="cooperative_experience_name[]" class="form-control" placeholder="Name of Cooperative">
                            </div>
                        </div>
                        <button type="button" class="btn btn-secondary" id="add-cooperative-experience">Add Another Experience</button>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Training/Seminars (Cooperative):</label>
                        <div id="training-container">
                            <div class="input-group mb-2">
                                <input type="text" name="training_date[]" class="form-control" placeholder="Inclusive Date">
                                <input type="text" name="training_course[]" class="form-control" placeholder="Course Description">
                                <input type="text" name="training_hours[]" class="form-control" placeholder="Number of Hours">
                            </div>
                        </div>
                        <button type="button" class="btn btn-secondary" id="add-training">Add Another Training/Seminar</button>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Business Activity (Present):</label>
                        <input type="text" name="business_present" class="form-control">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Business Activity (Previous):</label>
                        <input type="text" name="business_previous" class="form-control">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Civil, Social, and Religious Affiliation:</label>
                        <input type="text" name="affiliation" class="form-control">
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Annual Income:</label>
                        <input type="text" name="member_salary" class="form-control">
                            
                    </div>
                    <!-- Source of Income Section -->
                    <div class="mb-3">
                        <label class="form-label">Source of Income:</label>
                            <input type="text" name="other_income" class="form-control">
                    </div>

                    <!-- Crime Conviction Section -->
                    <div class="mb-3">
                        <label for="crime" class="form-label">Have you been accused or convicted of any crime?</label>
                        <select id="crime" name="crime" class="form-control" required>
                            <option value="">Select</option>
                            <option value="Yes">Yes</option>
                            <option value="No">No</option>
                        </select>
                    </div>

                    <div class="mb-3   
 form-check">
                        <input type="checkbox" class="form-check-input" id="certify" name="certify" required>
                        <label class="form-check-label" for="certify">I certify that the information provided is true and correct to the best of my knowledge.</label>
                    </div>

                    <button type="submit" class="btn btn-primary w-100">Register</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal -->
<div class="modal fade" id="errorModal" tabindex="-1" aria-labelledby="errorModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="errorModalLabel">Error</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p id="modalErrorMessage"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

    

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        document.getElementById('add-child').addEventListener('click',   
 function () {
            const container = document.getElementById('children-container');
            const newInput = document.createElement('input');
            newInput.setAttribute('type', 'text');
            newInput.setAttribute('name', 'children[]');
            newInput.classList.add('form-control', 'mb-2');
            newInput.setAttribute('placeholder', 'Child');
            container.appendChild(newInput);
        });

        document.getElementById('add-education').addEventListener('click', function () {
            const container = document.getElementById('education-container');
            const newGroup = document.createElement('div');
            newGroup.classList.add('input-group', 'mb-2');
            newGroup.innerHTML = `
                <input type="text" name="education_date[]" class="form-control" placeholder="Inclusive Date Attended">
                <input type="text" name="education_school[]" class="form-control" placeholder="Name of School">
                <input type="text" name="education_course[]" class="form-control" placeholder="Course/Degree">
            `;
            container.appendChild(newGroup);
        });

        document.getElementById('add-employment').addEventListener('click', function () {
            const container = document.getElementById('employment-container');
            const newGroup = document.createElement('div');
            newGroup.classList.add('input-group', 'mb-2');
            newGroup.innerHTML = `
                <input type="text" name="employment_date[]" class="form-control" placeholder="Inclusive Date">
                <input type="text" name="employment_position[]" class="form-control" placeholder="Position">
                <input type="text" name="employment_school[]" class="form-control" placeholder="Name of School">
            `;
            container.appendChild(newGroup);
        });

        document.getElementById('add-cooperative-experience').addEventListener('click', function () {
            const container = document.getElementById('cooperative-experience-container');
            const newGroup = document.createElement('div');
            newGroup.classList.add('input-group', 'mb-2');
            newGroup.innerHTML = `
                <input type="text" name="cooperative_experience_date[]" class="form-control" placeholder="Inclusive Date">
                <input type="text" name="cooperative_experience_position[]" class="form-control" placeholder="Position">
                <input type="text" name="cooperative_experience_name[]" class="form-control" placeholder="Name of Cooperative">
            `;
            container.appendChild(newGroup);
        });

        document.getElementById('add-training').addEventListener('click', function () {
            const container = document.getElementById('training-container');
            const newGroup = document.createElement('div');
            newGroup.classList.add('input-group', 'mb-2');
            newGroup.innerHTML = `
                <input type="text" name="training_date[]" class="form-control" placeholder="Inclusive Date">
                <input type="text" name="training_course[]" class="form-control" placeholder="Course Description">
                <input type="text" name="training_hours[]" class="form-control" placeholder="Number of Hours">
            `;
            container.appendChild(newGroup);
        });

        document.getElementById('birthday').addEventListener('change', function () {
            const birthday = this.value;
            const age = calculateAge(birthday);
            document.getElementById('age').value = age; // Update hidden age field
        });

        function calculateAge(birthday) {
            const today = new Date();
            const birthDate = new Date(birthday);
            let age = today.getFullYear() - birthDate.getFullYear();   

            const monthDifference = today.getMonth() - birthDate.getMonth();

            if (monthDifference < 0 || (monthDifference === 0 && today.getDate() < birthDate.getDate()))   
 {
                age--;
            }
            return age;   

        }

        document.getElementById('registration-form').addEventListener('submit', function (e) {
    e.preventDefault();

    const contact_no = document.getElementById('contact_no').value;
    const errors = [];

    // Check for valid contact number
    if (contact_no.length !== 11) {
        errors.push('Contact number must be 11 digits.');
    }

    // If there are errors, display them in the modal
    if (errors.length > 0) {
        // Show modal with error messages
        document.getElementById('modalErrorMessage').innerHTML = errors.join('<br>');
        const errorModal = new bootstrap.Modal(document.getElementById('errorModal'));
        errorModal.show();
        return;
    }

    // Generate member_id
    const date = new Date();
    const member_id = date.getFullYear() + String(date.getMonth() + 1).padStart(2, '0') + String(date.getDate()).padStart(2, '0') + String(Math.floor(Math.random() * 1000000000)).padStart(10, '0');
    document.getElementById('member_id').value = member_id;

    // Prepare form data for submission
    const formData = new FormData(this);

    // Make the fetch request
    fetch('register.php', {
        method: 'POST',
        body: formData
    })
    .then(response => response.text())
    .then(data => {
        if (data.includes('New record created successfully!')) {
            window.location.href = 'index.php';
        } else {
            // Show modal with server response as error
            document.getElementById('modalErrorMessage').innerHTML = data;
            const errorModal = new bootstrap.Modal(document.getElementById('errorModal'));
            errorModal.show();
        }
    })
    .catch(() => {
        // Show modal for generic error
        document.getElementById('modalErrorMessage').innerHTML = "An error occurred. Please try again later.";
        const errorModal = new bootstrap.Modal(document.getElementById('errorModal'));
        errorModal.show();
    });
});

document.addEventListener('DOMContentLoaded', function() {
        const errorModal = new bootstrap.Modal(document.getElementById('errorModal'));
        errorModal.hide(); // Ensure modal is hidden on load
    });

    </script>
</body>

</html>